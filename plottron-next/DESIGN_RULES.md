# デザイン保全ルール（Plottron Next）

本ドキュメントは、本プロジェクトの「現在のデザインを崩さない」ための運用ルールです。すべての UI 変更・実装は以下を満たすこと。

## 1. 目的と適用範囲

- 本番およびプレビュー環境での見た目・動作の一貫性維持
- `plottron-next/` 配下の UI（`app/`, `components/`, `styles/`, `public/`）に適用

## 2. 環境方針（本番 / プレビュー）

- 本番公開：レンタルサーバーにアップロードし、独自ドメインを割り当てて公開する
- プレビュー：Vercel へデプロイし、動き・表示崩れ・パフォーマンスを確認する（本番ではない）
- 秘密情報は Vercel ではプレビュー用環境変数に限定。本番の秘密情報はレンタルサーバー側の機構で管理

### 2.1 本番デプロイ方式

- 原則「静的出力（Static Export）」を採用（レンタルサーバーに Node 実行環境が無い前提）
- 手順（例）：
  1. `npm ci && npm run build`（静的出力設定の Next をビルド）
  2. 出力ディレクトリ（例：`out/` もしくはビルド設定に準ずる）をサーバーのドキュメントルートへアップ
  3. ドメインを割り当て、SSL を有効化
- もしサーバーで Node 実行が可能な場合のみ SSR 運用を検討（要合意）

### 2.2 プレビュー（Vercel）

- 目的：UI/UX・動作確認・レスポンシブ確認・パフォーマンス傾向の把握
- 位置づけ：本番ソースの「確認用」。設定は最小、`Root Directory = plottron-next` をダッシュボードで指定し、自動検出に委ねる
- `vercel.json` は原則作成しない。必要時のみ最小構成で一時的に使用し、後で除去

## 3. UI 変更の基本方針（必須）

- 既存のレイアウト構造（`app/layout.tsx` と `app/page.tsx`）を壊さない
- 既存のフォント構成（Geist, Bungee, Anton, Chewy）を変更しない
- 既存カラーとスペーシングスケールを優先。独自値は極力追加しない
- 新規 UI は再利用可能なコンポーネントとして `components/` に実装
- 既存 CSS の上書きではなく、まずは Tailwind ユーティリティで対応

## 4. タイポグラフィ / カラー

- フォント：`app/layout.tsx` で設定されたファミリー・変数を変更しない
- 色：Tailwind の色ユーティリティか既存 CSS 変数のみ使用（直値の 16 進・rgba は避ける）
- コントラスト：WCAG AA 相当を確保（小テキスト 4.5:1 以上）

## 5. レイアウト / スペーシング / 層（z-index）

- スペーシング：Tailwind のスケール（例: `p-4`, `gap-6`）のみ使用
- コンテナ幅：既存の幅・余白ユーティリティを踏襲（`max-w-*`, `mx-auto`）
- z-index ガイドライン：
  - 背景（装飾/キャンバス）：-1 〜 0
  - ベースコンテンツ：0 〜 10
  - 固定ヘッダー/ナビ：20
  - モーダル/オーバーレイ：50 以上

## 6. コンポーネント指針

- 公開 API（props）を明確化し、命名は意味的で一貫性を持たせる
- 視覚表現の責務はコンポーネント内に閉じる（ページでの局所 CSS は避ける）
- クラスの合成は `className` で行い、インラインスタイルは原則禁止（動的計算のみ可）

## 7. Tailwind 運用

- ユーティリティを優先。カスタム CSS は `styles/` に限定して最小限
- レスポンシブはモバイルファースト（`sm:`, `md:`, `lg:` の順で上書き）
- 余白・サイズ・色は既存スケールを使用。任意値（`[12px]` など）は要レビュー

## 8. 画像 / アセット

- 画像は `public/` 配下へ配置し、相対パスで参照
- 用途別ディレクトリ（例：`public/hero/`, `public/icons/`）
- 画像は最適化必須（写真: webp/jpg、透過: png、ベクタ: svg テキスト）

## 9. レスポンシブ / ブレークポイント

- 基本ブレークポイント：`sm (640px)`, `md (768px)`, `lg (1024px)`, `xl (1280px)`
- 各ブレークポイントで配置崩れ・はみ出しがないことを確認

### 9.1 PC専用調整の原則（モバイルは不変）

- 指示例「PCの画像を大きく」は、`lg` 以上のブレークポイントでのみ適用すること（`sm`/`md`は変えない）
- 実装例（Tailwind）：
  - 画像サイズ: `class="w-full md:w-auto lg:w-[120%] xl:w-[140%] max-w-none"`
  - 余白/フォント: `lg:text-lg xl:text-xl lg:py-8`
  - グリッド: `grid-cols-2 md:grid-cols-3 lg:grid-cols-4`
- 禁止：共通クラスの置換で全端末に波及させる変更（モバイルにまで影響）
- 確認：`sm/md/lg` の3段階で比較スクショをPRに添付

## 10. モーション / パフォーマンス

- アニメーションは CSS（GPU フレンドリー）を優先、JS アニメは最小限
- 60fps を目標。重い処理はスロットリング/`requestAnimationFrame` で制御
- スクロール/リサイズのイベントリスナはクリーンアップ必須

## 11. アクセシビリティ

- 画像には代替テキスト（`alt`）必須
- インタラクティブ要素はキーボード操作可能（`tabIndex`, `role` 適切化）
- フォーカスリングは視認可能に維持（`focus:*` を除去しない）

## 12. 禁止事項（要申請）

- グローバルスタイル（`globals.css`）の破壊的変更
- フォントファミリー/サイズ体系・カラー体系の変更
- 任意の px 指定の多用、ネガティブマージンの乱用
- インラインスタイルでの恒久的デザイン指定
- 画像の直貼り URL（`public/` 外参照）

## 13. 命名規約 / ファイル構成

- コンポーネント：`PascalCase` + 役割が分かる命名（例: `StoryDetailModal.tsx`）
- スタイル：コンポーネント単位で分離、スコープを限定
- データ/定数：`data/` に配置し、UI と分離

## 14. 変更フロー

1. デザイン影響の有無を記述して PR 作成（スクショ Before/After 必須）
2. Vercel Preview で各ブレークポイントを確認
3. レビューチェック完了後にマージ

## 15. レビュー前チェックリスト

- [ ] 既存フォント/色/余白スケールのみ使用
- [ ] 主要 3 解像度（モバイル/タブレット/デスクトップ）で崩れなし
- [ ] コントラスト AA 以上、フォーカス可視
- [ ] 画像最適化済み、`public/` 配下使用
- [ ] インラインスタイルなし（やむを得ず使用時は理由を記載）
- [ ] 不要 CSS/クラスの削除、バンドル肥大を招く変更なし
- [ ] Vercel Preview で最終確認済み

---

本ルールに反する変更はデザイン破綻の原因となるため、PR レビューで差し戻す場合があります。必要があれば、ルール改訂の提案を行ってください。

## 16. 例外運用（やむを得ずデザインを変更する場合）

「こちらの都合でいじらないといけない」ケースでも、次の手順に従えば変更可とする。

### 16.1 手順

1. フィーチャーブランチを作成（例：`feat/ui-adjust-<概要>`）
2. 下記テンプレートで「変更影響ログ」を PR 説明欄に記録
3. 1 変更点ずつコミット → プレビューで目視確認（各ブレークポイント）
4. 影響が想定外に広がった場合は即時リバート or スコープ縮小
5. 最終確認（チェックリスト全項目）後にレビュー依頼

### 16.2 変更影響ログ（PR 用テンプレート）

- 変更点: （例：`Header` の余白を `py-6 → py-4`）
- 目的/理由: （例：ファーストビュー高さ最適化）
- 影響箇所: （例：`Header`, トップページ FV, スクロール位置）
- 触れたトークン/ルール: （色/余白/フォント/ブレークポイント など具体的に）
- Before/After スクショ: （モバイル/タブレット/デスクトップ）
- 確認結果: （崩れなし/軽微/要フォロー）
- リスクとリバート手順: （戻し方を 1 行で記載）

### 16.3 実装ガイド

- 1 コミット = 1 変更点（差分を小さく保つ）
- 既存クラスを置換する前に、検証目的の一時クラスは併用して比較（後で除去）
- レイアウト値の変更は、関連コンポーネント（ヘッダー/モーダル/キャンバス）の相互影響を都度確認
- 変更範囲が `globals.css` に及ぶ場合は必ず相談（スコープ限定案を検討）

### 16.4 承認基準

- 変更影響ログが記入済み
- 各解像度のスクショが PR に添付済み
- レビュー前チェックリストが全て ✅
- 予期せぬ崩れがない（プレビューで人間の目視確認）

## 17. ブランチ / コミットポリシー

- ブランチ命名：`feat/*`, `fix/*`, `chore/*`, `docs/*`
- コミット：Conventional Commits（例：`feat: add StoryDetailModal`）
- PR には「変更影響ログ」と 3 解像度の Before/After を添付

## 18. 依存 / Node バージョン管理

- `next` / `react` / `react-dom` は固定レンジを維持（Major 自動アップグレード禁止）
- `engines.node` はローカル/Vercel と整合（例：`"node": ">=20 <23"`）

## 19. 生成物 / バックアップの扱い

- `.next/`, `out/`, `*-backup-*` などは `.gitignore` で除外
- 検証用ファイルはリポジトリに含めない

## 20. 拡張運用ガイド（カラー/カテゴリ/ページ/ロゴ/サイズ）

### 20.1 カラー・テーマの拡張

- 手順：まず CSS 変数（`globals.css` での `:root`）にトークンを追加 → Tailwind の `theme.extend.colors` へマップ
- 禁止：コンポーネント内で直接 16 進色を増やす。必ずトークン経由
- 追加時チェック：コントラスト AA、ダーク/ライト両方の見え方、ホバー/アクティブ状態

### 20.2 カテゴリの増減

- URL/slug の一貫性維持（既存リンクを壊さない）
- 一覧グリッドのカラム数はブレークポイントで安定（例：`sm:2 / md:3 / lg:4`）
- 空状態（Empty State）・大量時のページネーション/仮想化の検討

### 20.3 ページ追加

- 既存のページテンプレ（ヘッダー/メイン/フッターの情報設計）を踏襲
- `metadata` 設定（タイトル/説明/OG）を必須
- パンくず/戻る導線の用意（迷子防止）

### 20.4 ロゴの追加/運用

- 置き場所：`public/logos/`（ライト/ダーク両バリアントが望ましい）
- 最小サイズ/セーフエリアを厳守（縮小時に潰れないか確認）
- 使用箇所のコントラスト確保（背景との相性）

### 20.5 要素のサイズ変更（拡大/縮小）

- 原則 `clamp()` や Tailwind のレスポンシブユーティリティでスケーリング
- 画像は `aspect-[ratio]` / `object-cover` を利用して比率維持
- 上限例：
  - ヒーロー画像：`md:max-h-[70vh]` / `lg:max-h-[80vh]`
  - カード幅：`md:max-w-md` / `lg:max-w-lg`
- クリックターゲットは最小 44px 以上

### 20.6 破綻防止テスト（変更ごと）

- 3 解像度のスクショ比較、横幅可変でのにじみ/はみ出しチェック
- キーボード操作/フォーカスリング/コントラスト再確認
- 初回ロードの JS サイズ・LCP の目視評価（プレビュー）

### 20.7 クリエイティブ品質の指針

- 一度に導入する「新しさ」は 1 つに絞り、段階的に拡張
- タイポグラフィのリズム（行間/余白）を崩さない範囲で遊ぶ
- マイクロインタラクションは軽量・滑らか・控えめに（過剰は避ける）

### 20.8 レスポンシブ個別最適（PC とモバイルは別々に最良へ）

- 目的：PC では「余白に対する要素密度」を高め、モバイルでは「視認性とタップ性」を最優先
- 画像スケール：モバイル基準を維持しつつ、`lg+` では 1.2〜1.4 倍を目安に拡大（ヒーロー/カード）。比率は維持
- グリッド密度：`sm:2 / md:3 / lg:4(〜5)` を基準。カード最小幅を定義して詰まり/間延びを防止
- 余白/タイポ：`md+` で `leading` と `tracking` を微調整（読みやすさ優先）。PC は段落幅 60–75 文字目安
- 操作性：モバイルは可視ボタンと 44px 以上のタップ領域。PC はホバー/ツールチップ等を活用
- ナビゲーション：モバイルは折りたたみ、PC は常時表示で移動コストを下げる
- 非表示/簡略：重要度が低い装飾・補助要素は `sm` で簡略/非表示（情報は `sr-only` で補完可）
- 実装目安：Tailwind のブレークポイントで「見せ方」を分岐。`clamp()` で連続的にサイズ変化、`aspect-*` と `object-cover` で破綻防止
- 検証：PC で「画像が小さすぎないか」を重点確認（現状課題）。`lg+` のヒーロー/カード画像を 20–40% 拡大した案を比較し、最もバランスの良いものを採用
